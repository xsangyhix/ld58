[gd_scene load_steps=21 format=3 uid="uid://dsqg1iose3hju"]

[ext_resource type="Script" uid="uid://d0ga82dynwaas" path="res://scripts/controllers/ship/bottled_ship.gd" id="1_dt74a"]
[ext_resource type="Texture2D" uid="uid://dra0yjtbynteq" path="res://sprites/objects/bottled_ship_03.png" id="2_dt74a"]
[ext_resource type="Script" uid="uid://dxd1o8yb705nv" path="res://scripts/controllers/ship/ship_ui_controller.gd" id="3_p5hf5"]
[ext_resource type="Script" uid="uid://by1s7vmqc7ssu" path="res://scripts/fsm/state_machine.gd" id="4_5le8c"]
[ext_resource type="Script" uid="uid://lom7jg5cbf8p" path="res://scripts/controllers/ship/fsm/state_ship_active.gd" id="5_uyhyl"]
[ext_resource type="Script" uid="uid://fa8wit0syaea" path="res://scripts/controllers/ship/fsm/state_ship_passive.gd" id="6_j5x3f"]
[ext_resource type="Script" uid="uid://cvgpb6a0j3xip" path="res://scripts/controllers/ship/fsm/state_ship_break.gd" id="7_4rkv5"]
[ext_resource type="Script" uid="uid://btc44ww3xrl47" path="res://scripts/controllers/ship/BottledShipParticleController.gd" id="8_djwfm"]
[ext_resource type="Texture2D" uid="uid://csel6vr1awo5e" path="res://sprites/objects/bottle_particle_01.png" id="9_ag7ui"]
[ext_resource type="Texture2D" uid="uid://2y60whopo5k5" path="res://sprites/objects/ship_particle_01.png" id="10_lqpdm"]
[ext_resource type="Texture2D" uid="uid://dmqxund5rwmvb" path="res://sprites/objects/particles/ghost_particle_01.png" id="11_syv3d"]
[ext_resource type="Script" uid="uid://dly1hx62in0td" path="res://scripts/controllers/ship/ghost_particle_controller.gd" id="12_p5hf5"]

[sub_resource type="CircleShape2D" id="CircleShape2D_lkove"]
radius = 25.0

[sub_resource type="LabelSettings" id="LabelSettings_2x2ep"]
font_size = 12

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_op60w"]
lifetime_randomness = 0.5
particle_flag_disable_z = true
emission_shape = 1
emission_sphere_radius = 7.32
direction = Vector3(0, -1, 0)
spread = 60.0
initial_velocity_min = 40.0
initial_velocity_max = 60.0
angular_velocity_min = -500.0
angular_velocity_max = 499.99997
gravity = Vector3(0, 98, 0)

[sub_resource type="Curve" id="Curve_p5hf5"]
_data = [Vector2(0.0147058815, 1), 0.0, 0.0, 0, 0, Vector2(0.99999994, 0), -1.0696634, 0.0, 0, 0]
point_count = 2

[sub_resource type="CurveTexture" id="CurveTexture_5le8c"]
curve = SubResource("Curve_p5hf5")

[sub_resource type="Curve" id="Curve_uyhyl"]
_data = [Vector2(0, 0), 0.0, 4.0930986, 0, 0, Vector2(0.29411763, 0.9887641), 0.0, 0.0, 0, 0, Vector2(1, 1), 0.0, 0.0, 0, 0]
point_count = 3

[sub_resource type="CurveTexture" id="CurveTexture_j5x3f"]
curve = SubResource("Curve_uyhyl")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_4rkv5"]
lifetime_randomness = 0.2
particle_flag_disable_z = true
emission_shape_offset = Vector3(0, 1.165, 0)
emission_shape = 3
emission_box_extents = Vector3(7.94, 4.945, 1)
gravity = Vector3(0, -5, 0)
radial_accel_min = -5.000002
radial_accel_max = 4.9999976
tangential_accel_min = -5.000002
tangential_accel_max = 4.9999976
scale_curve = SubResource("CurveTexture_j5x3f")
alpha_curve = SubResource("CurveTexture_5le8c")

[node name="BottledShip" type="Node2D" node_paths=PackedStringArray("ship_particle_controller", "ship_ui_controller", "ship_sprite_2d", "ship_area_2d") groups=["ships"]]
script = ExtResource("1_dt74a")
ship_type = "random"
ship_tier = "T3"
ship_particle_controller = NodePath("ParticleSystem")
ship_ui_controller = NodePath("ShipUIController")
ship_sprite_2d = NodePath("Sprite2D")
ship_area_2d = NodePath("Area2D")

[node name="Sprite2D" type="Sprite2D" parent="."]
texture = ExtResource("2_dt74a")

[node name="Area2D" type="Area2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Area2D"]
shape = SubResource("CircleShape2D_lkove")

[node name="ShipUIController" type="Control" parent="." node_paths=PackedStringArray("ship_enter_label", "ship_collect_label")]
z_index = 1
layout_mode = 3
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -46.0
offset_top = -25.0
offset_right = 46.0
offset_bottom = 25.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 4
size_flags_vertical = 4
script = ExtResource("3_p5hf5")
ship_enter_label = NodePath("ShipEnterIndicator")
ship_collect_label = NodePath("ShipCollectIndicator")

[node name="ShipEnterIndicator" type="Label" parent="ShipUIController"]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -60.5
offset_right = 60.5
offset_bottom = 23.0
grow_horizontal = 2
text = "Press E to enter"
label_settings = SubResource("LabelSettings_2x2ep")
horizontal_alignment = 1

[node name="ShipCollectIndicator" type="Label" parent="ShipUIController"]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -60.0
offset_top = 34.0
offset_right = 61.0
offset_bottom = 57.0
grow_horizontal = 2
text = "Press F to collect"
label_settings = SubResource("LabelSettings_2x2ep")
horizontal_alignment = 1

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state")]
script = ExtResource("4_5le8c")
initial_state = NodePath("StateShipPassive")
metadata/_custom_type_script = "uid://by1s7vmqc7ssu"

[node name="StateShipActive" type="Node" parent="StateMachine" node_paths=PackedStringArray("bottled_ship_controller")]
script = ExtResource("5_uyhyl")
bottled_ship_controller = NodePath("../..")

[node name="StateShipPassive" type="Node" parent="StateMachine" node_paths=PackedStringArray("bottled_ship_controller")]
script = ExtResource("6_j5x3f")
bottled_ship_controller = NodePath("../..")
metadata/_custom_type_script = "uid://fa8wit0syaea"

[node name="StateShipBreak" type="Node" parent="StateMachine" node_paths=PackedStringArray("bottled_ship_controller")]
script = ExtResource("7_4rkv5")
bottled_ship_controller = NodePath("../..")

[node name="ParticleSystem" type="Node2D" parent="." node_paths=PackedStringArray("glass_particles", "wood_particles")]
script = ExtResource("8_djwfm")
glass_particles = NodePath("GPUParticles2DGlass")
wood_particles = NodePath("GPUParticles2DWood")

[node name="GPUParticles2DGlass" type="GPUParticles2D" parent="ParticleSystem"]
emitting = false
amount = 35
texture = ExtResource("9_ag7ui")
lifetime = 2.0
one_shot = true
explosiveness = 1.0
process_material = SubResource("ParticleProcessMaterial_op60w")

[node name="GPUParticles2DWood" type="GPUParticles2D" parent="ParticleSystem"]
emitting = false
amount = 25
texture = ExtResource("10_lqpdm")
lifetime = 2.0
one_shot = true
explosiveness = 1.0
process_material = SubResource("ParticleProcessMaterial_op60w")

[node name="FVX" type="Node2D" parent="."]

[node name="GhostParticles" type="GPUParticles2D" parent="FVX" node_paths=PackedStringArray("ship_root")]
amount = 3
texture = ExtResource("11_syv3d")
lifetime = 4.0
process_material = SubResource("ParticleProcessMaterial_4rkv5")
script = ExtResource("12_p5hf5")
ship_root = NodePath("../..")
